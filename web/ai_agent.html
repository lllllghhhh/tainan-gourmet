<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å°å—ç¾é£Ÿ AI Agent</title>

  <!-- å…±ç”¨æ¨£å¼ -->
  <link rel="stylesheet" href="css/style.css">

  <style>
    .agent-box {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 16px;
      background: #fff;
    }
    .agent-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 12px;
      align-items: center;
    }
    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
    }
    button {
      padding: 10px 16px;
      cursor: pointer;
    }
    pre {
      white-space: pre-wrap;
      background: #f7f7f7;
      padding: 12px;
      border-radius: 8px;
    }
    select, input {
      padding: 8px;
      min-width: 180px;
    }
  </style>
</head>

<body>
  <!-- ===== Header ===== -->
  <header class="site-header">
    <div class="header-spacer"></div>
    <div class="header-inner">
      <div class="brand">
        <img src="image/IIM_logo.png" class="logo-img" alt="IIMå¥½é£Ÿåœ¨ Logo">
      </div>
      <nav class="main-nav" aria-label="ä¸»é¸å–®">
        <a href="index.html">é¦–é </a>

        <div class="dropdown">
          <button class="dropbtn" type="button">é£Ÿç‰©ç¨®é¡ â–¼</button>
          <div class="dropdown-content">
            <a href="tainan.html">å°å—ç‰¹è‰²ç¾é£Ÿ</a>
            <a href="ramen.html">æ‹‰éºµ</a>
            <a href="japaness.html">ä¸¼é£¯ & æ—¥å¼æ–™ç†</a>
            <a href="noodles.html">é‹ç‡’æ„éºµ</a>
            <a href="beef_soup.html">ç‰›è‚‰æ¹¯å°ˆå€</a>
            <a href="midnight.html">å®µå¤œåº—</a>
          </div>
        </div>

        <a href="spin.html">ç¾é£Ÿæ‹‰éœ¸æ©Ÿ</a>
        <a href="diet.html">ç½ªæƒ¡è¨ˆç®—æ©Ÿ</a>
        <a href="ai_agent.html" class="active">AI Agent</a>
      </nav>
    </div>
  </header>

  <div class="header-spacer"></div>

  <!-- ===== ä¸»å…§å®¹ ===== -->
  <main class="content">
    <h2>ğŸœ å°å—ç¾é£Ÿæ¨è–¦ AI Agent</h2>
    <p>
      ä¾ç…§åœ°å€ã€æ™‚æ®µèˆ‡é ç®—ï¼Œæ¨è–¦é©åˆä½ çš„å°å—ç¾é£Ÿã€‚
      ï¼ˆæœ¬é åªå‘¼å«æœ¬æ©Ÿ proxyï¼š<code>http://127.0.0.1:11435</code>ï¼‰
    </p>

    <div class="agent-box">
      <div class="agent-row">
        <label for="model">æ¨¡å‹ï¼š</label>
        <select id="model" aria-label="æ¨¡å‹">
          <option value="gpt-oss:20b">gpt-oss:20b</option>
        </select>
        <button id="btnModels" type="button">é‡æ–°è¼‰å…¥æ¨¡å‹</button>
        <span id="status"></span>
      </div>

      <h3>ä½ çš„éœ€æ±‚</h3>

      <div class="agent-row">
        <select id="area" aria-label="åœ°å€">
          <option value="">åœ°å€ï¼ˆä¸æŒ‡å®šï¼‰</option>
          <option>ä¸­è¥¿å€</option>
          <option>æˆå¤§å‘¨é‚Š</option>
          <option>å®‰å¹³</option>
          <option>æ±å€</option>
        </select>

        <select id="time" aria-label="æ™‚æ®µ">
          <option value="">æ™‚æ®µï¼ˆä¸æŒ‡å®šï¼‰</option>
          <option>æ—©é¤</option>
          <option>åˆé¤</option>
          <option>æ™šé¤</option>
          <option>å®µå¤œ</option>
        </select>

        <select id="budget" aria-label="é ç®—">
          <option value="">é ç®—ï¼ˆä¸æŒ‡å®šï¼‰</option>
          <option>100 ä»¥ä¸‹</option>
          <option>100â€“200</option>
          <option>200â€“400</option>
          <option>400 ä»¥ä¸Š</option>
        </select>
      </div>

      <textarea id="prompt" placeholder="ä¾‹å¦‚ï¼šæˆå¤§é™„è¿‘å®µå¤œï¼Œä¸è¦å¤ªè²´"></textarea>

      <div class="agent-row">
        <button id="send" type="button">é€å‡ºæ¨è–¦</button>
      </div>

      <h3>AI æ¨è–¦çµæœ</h3>
      <pre id="out"></pre>
    </div>
  </main>

  <script src="/js/agent.js"></script>
  <script>
    const statusEl = document.getElementById("status");
    const outEl = document.getElementById("out");

    async function refreshModels() {
      statusEl.textContent = "è®€å–ä¸­...";
      try {
        // é€™å€‹å‡½å¼åœ¨ js/agent.js è£¡
        await agentFillModelSelect("model");
        statusEl.textContent = "å®Œæˆ";
      } catch (e) {
        statusEl.textContent = "å¤±æ•—ï¼ˆç¢ºèª proxy æœ‰æ²’æœ‰è·‘ï¼‰";
        outEl.textContent = String(e);
      }
    }

    document.getElementById("btnModels").onclick = refreshModels;

    document.getElementById("send").onclick = async () => {
      const model = document.getElementById("model").value;
      const area = document.getElementById("area").value;
      const time = document.getElementById("time").value;
      const budget = document.getElementById("budget").value;
      const text = document.getElementById("prompt").value.trim();
      if (!text) return;

      const finalPrompt =
        `è«‹æ¨è–¦å°å—ç¾é£Ÿï¼ˆç¹é«”ä¸­æ–‡ï¼‰ã€‚\n` +
        `è¼¸å‡ºè¦æ ¼ï¼š\n` +
        `- æ¨è–¦ 3-5 é–“åº—\n` +
        `- æ¯é–“ï¼šåº—å / é¡å‹ / å¤§æ¦‚åƒ¹ä½ / æ¨è–¦åŸå›  / é©åˆæ™‚æ®µ / å¤§æ¦‚å€åŸŸ\n` +
        `- è‹¥è³‡è¨Šä¸è¶³ï¼Œå…ˆå•æˆ‘ 1-2 å€‹é—œéµå•é¡Œå†æ¨è–¦\n\n` +
        `æ¢ä»¶ï¼š\n` +
        (area ? `- åœ°å€ï¼š${area}\n` : "") +
        (time ? `- æ™‚æ®µï¼š${time}\n` : "") +
        (budget ? `- é ç®—ï¼š${budget}\n` : "") +
        `- éœ€æ±‚ï¼š${text}\n`;

      statusEl.textContent = "è«‹æ±‚ä¸­...";
      outEl.textContent = "";

      try {
        const data = await agentSend(finalPrompt, model);
        outEl.textContent = data.message?.content ?? JSON.stringify(data, null, 2);
        statusEl.textContent = "å®Œæˆ";
      } catch (e) {
        statusEl.textContent = "å¤±æ•—ï¼ˆç¢ºèª proxy æœ‰æ²’æœ‰è·‘ï¼‰";
        outEl.textContent = String(e);
      }
    };

    // é€²é é¢è‡ªå‹•è¼‰å…¥æ¨¡å‹
    refreshModels();
  </script>
</body>
</html>
