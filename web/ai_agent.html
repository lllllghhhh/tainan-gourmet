<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å°å—ç¾é£Ÿ AI Agent</title>

  <link rel="stylesheet" href="css/style.css">

  <style>
    .agent-box {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 16px;
      background: #fff;
    }
    .agent-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 12px;
      align-items: center;
    }
    textarea {
      width: 100%;
      height: 160px;
      padding: 10px;
    }
    button {
      padding: 10px 16px;
      cursor: pointer;
    }
    pre {
      white-space: pre-wrap;
      background: #f7f7f7;
      padding: 12px;
      border-radius: 8px;
      margin: 0;
    }
    select, input {
      padding: 8px;
      min-width: 200px;
    }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="header-spacer"></div>
    <div class="header-inner">
      <div class="brand">
        <img src="image/IIM_logo.png" class="logo-img" alt="IIMå¥½é£Ÿåœ¨ Logo">
      </div>

      <nav class="main-nav" aria-label="ä¸»é¸å–®">
        <a href="index.html">é¦–é </a>

        <div class="dropdown">
          <button class="dropbtn" type="button">é£Ÿç‰©ç¨®é¡ â–¼</button>
          <div class="dropdown-content">
            <a href="tainan.html">å°å—ç‰¹è‰²ç¾é£Ÿ</a>
            <a href="ramen.html">æ‹‰éºµ</a>
            <a href="japaness.html">ä¸¼é£¯ & æ—¥å¼æ–™ç†</a>
            <a href="noodles.html">é‹ç‡’æ„éºµ</a>
            <a href="beef_soup.html">ç‰›è‚‰æ¹¯å°ˆå€</a>
            <a href="midnight.html">å®µå¤œåº—</a>
          </div>
        </div>

        <a href="spin.html">ç¾é£Ÿæ‹‰éœ¸æ©Ÿ</a>
        <a href="diet.html">ç½ªæƒ¡è¨ˆç®—æ©Ÿ</a>
        <a href="ai_agent.html" class="active">AI Agent</a>
      </nav>
    </div>
  </header>

  <div class="header-spacer"></div>

  <main class="content">
    <h2>ğŸœ å°å—ç¾é£Ÿæ¨è–¦ AI Agent</h2>
    <p>
      ç›´æ¥æè¿°ä½ çš„éœ€æ±‚ï¼ˆä¾‹å¦‚ï¼šäººæ•¸ã€å£å‘³ã€æ˜¯å¦æ’éšŠã€åœ°é»ã€é ç®—ã€æ™‚æ®µï¼‰ã€‚
      <br>ï¼ˆæœ¬é é€éå¾Œç«¯ <code>/proxy</code> å‘¼å«ä¸Šæ¸¸ï¼Œä¸æœƒæŠŠ API Key æš´éœ²åœ¨å‰ç«¯ï¼‰
    </p>

    <div class="agent-box">
      <div class="agent-row">
        <label for="model">æ¨¡å‹ï¼š</label>
        <select id="model" aria-label="æ¨¡å‹">
          <option value="gpt-oss:20b">gpt-oss:20b</option>
        </select>

        <button id="btnModels" type="button">é‡æ–°è¼‰å…¥æ¨¡å‹</button>
        <span id="status"></span>
      </div>

      <h3>ä½ çš„éœ€æ±‚</h3>
      <textarea id="prompt" placeholder="ä¾‹å¦‚ï¼šæˆå¤§é™„è¿‘å…©å€‹äººï¼Œæƒ³åƒå®µå¤œï¼Œä¸è¦å¤ªæ²¹ï¼Œé ç®— 200 å…§ï¼Œä¸æƒ³æ’éšŠ"></textarea>

      <div class="agent-row">
        <button id="send" type="button">é€å‡ºæ¨è–¦</button>
      </div>

      <h3>AI æ¨è–¦çµæœ</h3>
      <pre id="out"></pre>
    </div>
  </main>

  <script src="js/agent.js"></script>
  <script>
    const statusEl = document.getElementById("status");

    async function loadModelsIntoSelect() {
      const modelSel = document.getElementById("model");
      statusEl.textContent = "è®€å–ä¸­...";

      try {
        const data = await agentListModels();
        const names = (data.models || []).map(m => m.name).filter(Boolean);

        modelSel.innerHTML = "";
        for (const name of names) {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          modelSel.appendChild(opt);
        }

        const preferred = "gpt-oss:20b";
        if (names.includes(preferred)) modelSel.value = preferred;
        else if (names.length) modelSel.value = names[0];

        statusEl.textContent = "å®Œæˆ";
      } catch (e) {
        statusEl.textContent = "å¤±æ•—ï¼ˆç¢ºèª server/proxy æ˜¯å¦å•Ÿå‹•ï¼‰";
      }
    }

    document.getElementById("btnModels").onclick = loadModelsIntoSelect;

    document.getElementById("send").onclick = async () => {
      const model = document.getElementById("model").value;
      const text = document.getElementById("prompt").value.trim();
      if (!text) return;

      const finalPrompt =
        "ä½ æ˜¯ã€Œå°å—ç¾é£Ÿæ¨è–¦ã€AIï¼Œè«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚\n" +
        "è«‹è¼¸å‡ºï¼š\n" +
        "1) æ¨è–¦ 3â€“5 é–“åº—ï¼ˆæ¯é–“ï¼šåº—å / é¡å‹ / å¤§æ¦‚åƒ¹ä½ / æ¨è–¦åŸå›  / é©åˆæ™‚æ®µ / å¤§æ¦‚å€åŸŸï¼‰\n" +
        "2) è‹¥è³‡è¨Šä¸è¶³ï¼Œå…ˆå•æˆ‘ 1â€“2 å€‹é—œéµå•é¡Œå†æ¨è–¦ã€‚\n\n" +
        "æˆ‘çš„éœ€æ±‚å¦‚ä¸‹ï¼š\n" + text;

      statusEl.textContent = "è«‹æ±‚ä¸­...";
      document.getElementById("out").textContent = "";

      try {
        const data = await agentSend(finalPrompt, model);
        document.getElementById("out").textContent =
          data.message?.content ?? JSON.stringify(data, null, 2);
        statusEl.textContent = "å®Œæˆ";
      } catch (e) {
        statusEl.textContent = "å¤±æ•—ï¼ˆç¢ºèª server/proxy æ˜¯å¦å•Ÿå‹•ï¼‰";
        document.getElementById("out").textContent = String(e);
      }
    };

    // é€²é é¢è‡ªå‹•è¼‰å…¥æ¨¡å‹
    loadModelsIntoSelect();
  </script>
</body>
</html>
